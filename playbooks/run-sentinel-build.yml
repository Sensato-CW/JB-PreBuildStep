---
- name: Sentinel â€“ Run Local Build Script
  hosts: all
  become: true
  gather_facts: false

  tasks:

    - name: Ensure SentinelBuildScripts exists
      stat:
        path: /opt/SentinelBuildScripts
      register: sentinel_dir

    - name: Fail if SentinelBuildScripts missing
      fail:
        msg: "SentinelBuildScripts directory not found. Run prebuild first."
      when: not sentinel_dir.stat.exists

    - name: Execute Sentinel build script
      shell: /bin/bash /opt/SentinelBuildScripts/build-chronicle-sentinel-1125.sh
      register: build_result

    - name: Show build output
      debug:
        var: build_result.stdout_lines

    - name: Fail if build failed
      fail:
        msg: "Sentinel build failed."
      when: build_result.rc != 0
